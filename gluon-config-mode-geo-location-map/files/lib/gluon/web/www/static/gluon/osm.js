function findObj(a){for(list=document.getElementsByClassName("gluon-input-text"),i=0;i<list.length;i++)if(item=list.item(i),item.id.indexOf(a)>=0)return item;return!1}function showMap(){if("object"==typeof OpenLayers&&!1!==findObj("longitude")){document.getElementById("locationPickerMap").style.display="block";var a=new OpenLayers.Projection("EPSG:4326"),b=new OpenLayers.Projection("EPSG:900913"),c=12,d=new OpenLayers.Layer.Markers("Markers");OpenLayers.Control.Click=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{single:!0,double:!1,pixelTolerance:0,stopSingle:!1,stopDouble:!1},initialize:function(){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions),OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Click(this,{click:this.trigger},this.handlerOptions)},trigger:function(c){var e=osmMap.getLonLatFromPixel(c.xy);oLon=findObj("longitude"),oLat=findObj("latitude"),lonlat1=new OpenLayers.LonLat(e.lon,e.lat).transform(b,a),oLon.value=lonlat1.lon,oLat.value=lonlat1.lat,d.clearMarkers(),d.addMarker(new OpenLayers.Marker(e)),oLon.className=oLon.className.replace(/ gluon-input-invalid/g,""),oLat.className=oLat.className.replace(/ gluon-input-invalid/g,"")}}),osmMap=new OpenLayers.Map("locationPickerMap",{controls:[new OpenLayers.Control.Navigation,new OpenLayers.Control.PanZoomBar,new OpenLayers.Control.MousePosition],maxExtent:new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),numZoomLevels:18,maxResolution:156543,units:"m",projection:b,displayProjection:a});var e=new OpenLayers.Layer.OSM("OpenStreetMap");osmMap.addLayer(e),osmMap.addLayer(d);var f=longitude,g=latitude;oLon=findObj("longitude"),oLat=findObj("latitude"),""!=oLon.value&&(f=oLon.value),""!=oLat.value&&(g=oLat.value),d.addMarker(new OpenLayers.Marker(new OpenLayers.LonLat(f,g).transform(a,b)));var h=new OpenLayers.LonLat(f,g),i=h.transform(a,b);osmMap.setCenter(i,c);var j=new OpenLayers.Control.Click;osmMap.addControl(j),j.activate()}else setTimeout(showMap,1e3)}
